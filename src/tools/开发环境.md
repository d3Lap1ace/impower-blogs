# 环境配置
## Docker 部署配置
### 安装mysql
```shell
# 拉取镜像
docker pull mysql

# 启动
docker run -d \
-p 3306:3306 \
-v /mysql/mysql/conf:/etc/mysql/conf.d \
-v /mysql/mysql/data:/var/lib/mysql \
-e MYSQL_ROOT_PASSWORD=root \
--name mysql \
--restart=always \
mysql

# 进入容器：
docker exec -it mysql /bin/bash

# 登录mysql：
mysql -uroot -proot

# 如果顺利进入，安装成功
#修改默认密码校验方式 
ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY 'root';
```



### 安装redis
```shell
# 拉取镜像
docker pull mysql

# 启动
docker run -d \
--name=redis \
-p 6379:6379 \
--restart=always \
redis \

# 进入容器：
docker exec -it redis /bin/bash
```



### 安装nacos

```shell
# 拉取镜像
docker pull nacos/nacos-server

# 启动
docker run -d \
-e MODE=standalone \
-p 8848:8848 \
-p 9848:9848 \
-p 9849:9849 \
--name nacos \
--restart=always \
nacos/nacos-server

# 进入容器：
docker exec -it nacos/nacos-server /bin/bash
```


### 安装sentinel

```shell
# 拉取镜像
docker pull bladex/sentinel-dashboard

# 启动
docker run -d \
--name=sentinel-dashboard \
-p 8858:8858 \
--restart=always \
bladex/sentinel-dashboard \

# 进入容器：
docker exec -it sentinel-dashboard /bin/bash
```



### 安装minio
```shell
# 拉取镜像
docker pull minio/minio

# 启动
docker run -d \
-p 9000:9000 \
-p 9001:9001 \
--name=minio \
--restart=always \
-e "MINIO_ROOT_USER=minioadmin" \
-e "MINIO_ROOT_PASSWORD=minioadmin" \
-v spzx_minio-data:/data \
-v spzx_minio-config:/root/.minio \
minio/minio server /data --console-address ":9001"

# 进入容器：
docker exec -it minio /bin/bash
```
**注意**：文件上传时，需要调整一下linux 服务器的时间与windows 时间一致！
> 第一步：安装ntp服务 yum -y install ntp 
> 第二步：开启开机启动服务 systemctl enable ntpd 
> 第三步：启动服务 systemctl start ntpd
> 第四步：更改时区 timedatectl set-timezone Asia/Shanghai 
> 第五步：启用ntp同步 timedatectl set-ntp yes 
> 第六步：同步时间 ntpq -p



### 安装rabbitmq

```shell
# 拉取镜像
docker pull rabbitmq

# 启动
docker run -d \
--name=rabbitmq \
-e RABBITMQ_DEFAULT_USER=admin \
-e RABBITMQ_DEFAULT_PASS=admin \
-p 5672:5672 \
-p 15672:15672 \
--hostname myRabbit
-v myRabbit_data:/var/lib/rabbitmq \
-v myRabbit_conf:/etc/rabbitmq \
--restart=always \
rabbitmq \

# 进入容器：
docker exec -it rabbitmq /bin/bash
```


安装延迟队列插件 

1. 下载地址：[https://www.rabbitmq.com/community-plugins.html](https://www.rabbitmq.com/community-plugins.html)         
2. 切换到插件所在目录，执行` docker cp rabbitmq_delayed_message_exchange-3.12.0.ez rabbitmq:/plugins `命令，将刚插件拷贝到容器内plugins目录下
3. 执行` docker exec -it rabbitmq /bin/bash `命令进入到容器内部
4. 执行` cd plugins `进入plugins目录,然后执行` ls -l|grep delay  `命令查看插件是否copy成功
5. 在容器内plugins目录下，执行` rabbitmq-plugins enable rabbitmq_delayed_message_exchange  `命令启用插件
6. exit命令退出RabbitMQ容器内部，然后执行` docker restart rabbitmq`命令重启RabbitMQ容器



### 环境测试

使用mysql/redis客户端工具远程连接mysql/redis测试
nacos控制台访问测试:  ` http://虚拟机IP:8848/nacos       `   账号密码：nacos/nacos
rabbitmq控制台访问测试：`http://虚拟机IP:15672 ` 账号密码：guest/guest
minio控制台访问测试：`http://虚拟机IP:9001`  账号密码：minioadmin/minioadmin
sentinel控制台访问测试：`http://虚拟机IP:8858` 账号密码：sentinel/sentinel

**注意：如果访问失败**
1、检查容器是否创建启动成功，可能是端口号占用导致，需要先关闭占用端口号的进程或修改当前容器的端口号
2、检查防火墙是否关闭
3、配置虚拟机允许IPv4地址跳转
```shell
# 修改配置文件：
vim /usr/lib/sysctl.d/00-system.conf
# 添加
net.ipv4.ip_forward=1

# 保存退出 重启网络
systemctl restart network
# 重启docker
systemctl restart docker
```



## 原生 部署配置

### 配置jkd
> 第一步 查询系统中自带的JDK
> rpm -qa | grep jdk

> 第二步 卸载系统中自带的JDK
> rpm -e --nodeps jdk的rpm软件包的名字

> 第三步 将jdk.tar.gz上传到/opt目录下

> 第四步 解压jdk压缩包
> tar -zxvf jdk压缩包名称

> 第五步 在/etc/profile.d目录下创建my_env.sh文件(系统不建议直接修改/etc/profile)
> cd /etc/profile.d
> touch my_env.sh

> 第六步 在my_env.sh文件中配置JAVA_HOME环境变量
> #JAVA_HOME  
> JAVA_HOME=/opt/jdk-17.0.7  
> PATH=$PATH:$JAVA_HOME/bin  
> export PATH JAVA_HOME

> 第七步 执行source /etc/profile.d/my_env.sh使环境变量立即生效，如果不生效就重启

### Tomcat

Tomcat官方网站：[http://tomcat.apache.org/](http://tomcat.apache.org/)

### **linux**

> 第一步  将tomcat的压缩包上传到/opt目录下

> 第二步  解压缩tomcat的压缩包

> 第三步 进入tomcat的bin目录执行./startup.sh启动tomcat服务器

> 第四步 可以配置tomcat的环境变量，这样就可以在任意目录下执行startup.sh启动tomcat了

### **Windows**

1. 正确安装JDK并配置JAVA_HOME。
2. 解压Tomcat到非中文无空格目录。
3. 点击bin/startup.bat启动。
4. 打开浏览器输入 http://localhost:8080访问测试。
5. 直接关闭窗口或者运行 bin/shutdown.bat关闭tomcat。 
6. 处理dos窗口日志中文乱码问题：修改conf/logging.properties，ConsoleHandler.encoding的UTF-8修改为GBK。

### MySQL
#### 前置准备
#### 卸载系统自带的mariaDB
```bash
#CentOS7中默认安装了mariaDB
#检查是否安装，-i 表示忽略大小写，如果显示完整的rpm的名字，则表示已安装
rpm -qa|grep -i mariaDB
#卸载， --nodeps 表示排除依赖，否则如果别的软件依赖mysql，则无法删除
rpm -e --nodeps mariadb-libs
```
#### 卸载MySQL8
`1.停止MySQL服务`
```shell
systemctl stop mysqld
```
`2.查看当前MySQL安装状况`
```shell
rpm -qa|grep -i mysql
```
`3.卸载上述命令查询出的所有已安装程序`
```bash

rpm -e --nodeps mysql-community-common
rpm -e --nodeps mysql-community-server
rpm -e --nodeps mysql-community-libs
rpm -e --nodeps mysql-community-icu-data-files
rpm -e --nodeps mysql-community-client
rpm -e --nodeps mysql-community-client-plugins
```
`4.删除残留文件`
查找相关文件
```shell
find / -name mysql
```
删除上述命令查找出的相关文件
```shell
rm -rf /etc/selinux/targeted/active/modules/100/mysql
rm -rf /etc/selinux/targeted/tmp/modules/100/mysql
rm -rf /usr/lib64/mysql
rm -rf /var/lib/mysql
```
`5.删除配置文件和日志`
```shell
rm -f /etc/my.cnf* #如果有的话
rm -f /var/log/mysqld.log
```
#### 检查必要依赖
查询是否安装了如下依赖
```shell
rpm -qa|grep libaio
rpm -qa|grep net-tools
rpm -qa|grep perl
```
如果不存在，则需要安装
```shell
yum install libaio -y
yum install net-tools -y
yum install perl -y
yum install numactl -y
```

#### 检查/tmp临时目录权限

由于MySQL安装过程中，会通过MySQL用户在/tmp目录下新建tmp_db文件，所以请给/tmp较大的权限。

权限检查：

```shell
ll -a /
```

如果权限不是777则授权为777：

```shell
chmod -R 777 /tmp
```

#### 安装

#### 1. 解压

将安装程序上传至到/opt目录下，并解压：

```shell
cd /opt
```

#### 2. 安装

在安装文件目录下执行以下命令**（必须按照顺序执行）：**

```shell
rpm -ivh mysql-community-common-8.0.30-1.el7.x86_64.rpm
rpm -ivh mysql-community-client-plugins-8.0.30-1.el7.x86_64.rpm
rpm -ivh mysql-community-libs-8.0.30-1.el7.x86_64.rpm
rpm -ivh mysql-community-icu-data-files-8.0.30-1.el7.x86_64.rpm
rpm -ivh mysql-community-client-8.0.30-1.el7.x86_64.rpm
rpm -ivh mysql-community-server-8.0.30-1.el7.x86_64.rpm

//一定要进入到opt文件夹
# -i, --install    安装软件包
# -v, --verbose    提供更多的详细信息输出
# -h, --hash       软件包安装的时候列出哈希标记 (和 -v 一起使用效果更好)，展示进度条
```

#### 3. 查看是否安装成功

```shell
rpm -qa|grep -i mysql
```

#### 4. 查看版本

```bash
mysqladmin --version
```

#### 安装后的目录结构
| 路径 | 解释 |
| --- | --- |
| /usr/bin | 相关命令目录，mysqladmin等 |
| `/var/lib/mysql/` | MySQL数据库文件的存放路径 |
| /usr/lib64/mysql/plugin | MySQL |
| `/var/log/mysqld.log` | MySQL日志路径 |
| /var/run/mysqld/mysqld.pid | 进程pid文件 |
| /var/lib/mysql/mysql.sock | 本地连接时用的套接字文件 |
| /etc/systemd/system/multi-user.target.wants/mysqld.service | 服务启停相关脚本 |
| `/etc/my.cnf`
、/usr/share/mysql-8.0 | MySQL配置文件 |


#### 启动

```bash
#初始化数据目录并生成初始密码
mysqld --initialize --user=mysql
#查看数据目录
ls /var/lib/mysql/
```

#### 服务的启动和停止

```shell
#启动，安装完MySQL第一次启动服务时，也会同时执行服务的初始化，因此也可以省略5.1
#如果省略了步骤5.1，并且启动失败，则说明之前安装的MySQL没有卸载干净，数据目录/var/lib/mysql/没有删除
#请删除数据目录后再重新启动
systemctl start mysqld
#关闭
systemctl stop mysqld
#重启
systemctl restart mysqld
#查看服务状态
systemctl status mysqld
```

#### 查看进程

```shell
#进程存在则说明MySQL启动成功
ps -ef|grep -i mysql
```

#### 设置开机启动

```shell
#查看服务是否自动启动（是：enabled | 否：disabled）
systemctl list-unit-files|grep mysqld.service 

#设置开机启动：如不是enabled可以运行如下命令设置自启动
systemctl enable mysqld
#重新加载服务配置
systemctl daemon-reload 

#如果希望不进行自启动，运行如下命令设置
systemctl disable mysqld
#重新加载服务配置
systemctl daemon-reload
```

#### 配置密码

#### 查找初始密码

```shell
#mysql安装完成之后，在/var/log/mysqld.log文件中给root生成了一个默认密码。通过下面的方式找到root默认密码，然后登录mysql。
grep 'temporary password' /var/log/mysqld.log
或者使用  more /var/log/mysqld.log
```

#### 登录MySQL客户端

```shell
mysql -uroot -p
#然后输入上面找到的默认密码
```

#### 修改密码

因为初始密码只是一个临时密码，默认只可以登录，无法做其他操作，因此我们需要重置密码

```sql
ALTER USER 'root'@'localhost' IDENTIFIED BY '123456';
-- 或者
SET password FOR 'root'@'localhost'= '123456';
```

#### 忘记root密码

**需要的时候参考**

在/etc/my.cnf 文件[mysqld]中加上：

```properties
skip_grant_tables=1
```

重新启动mysql服务使配置生效：

```shell
systemctl restart mysqld
```

就可以无需密码登录MySQL客户端

```shell
mysql -uroot
```

接下来可以执行修改密码的语句重置密码

### 相关问题

#### 远程连接问题

在用SQLyog或Navicat中配置远程连接MySQL数据库时遇到如下报错信息，这是由于MySQL默认不支持远

程连接。

查看系统数据库MySQL中的user表：

```sql
USE mysql;
SELECT Host,User FROM user;
```

可以看到root用户的当前主机配置信息为localhost。**修改Host为通配符%**

Host列指定了允许用户登录所使用的IP：

-  `Host=localhost`，表示只能通过本机客户端去访问。 
-  `Host=%` ，表示所有IP都有连接权限。 

```sql
UPDATE user SET Host = '%' WHERE User ='root';
FLUSH PRIVILEGES; -- Host修改完成后记得执行FLUSH PRIVILEGES使配置立即生效：
```

> 注意：在生产环境下不能为了省事将host设置为%，这样做会存在安全问题，可以设置为生产环境IP。


#### 使用SQLyog连接

出现这个原因是MySQL 8 之前的版本中加密规则是mysql_native_password，而在MySQL 8之后，加密规则是caching_sha2_password。

解决方案有两种，一种是升级SQLyog和Navicat（因此，新版SQLyog不会出现此问题），另一种是把MySQL用户登录密码加密规则还原成mysql_native_password。

**解决方法：**Linux下 mysql -uroot -p 登录你的 MySQL 数据库，然后 执行这条SQL：

```sql
ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY '123456';
```

然后再重新配置SQLyog的连接，重新填写密码，则可连接成功了。

### minio

rpm -ivh minio-20230809233022.0.0.x86_64.rpm

**编写MinIO服务配置文件**

Systemd所管理的服务需要由一个配置文件进行描述，这些配置文件均位于`/etc/systemd/system/`或者`/usr/lib/systemd/system/`目录下，下面创建MinIO服务的配置文件。

执行以下命令创建并打开`minio.service`文件

```bash
vim /etc/systemd/system/minio.service
```

内容如下，具体可参考MinIO[官方文档](https://min.io/docs/minio/linux/operations/install-deploy-manage/deploy-minio-single-node-single-drive.html#create-the-systemd-service-file)。

```properties
[Unit]
Description=MinIO
Documentation=https://min.io/docs/minio/linux/index.html
Wants=network-online.target
After=network-online.target
AssertFileIsExecutable=/usr/local/bin/minio

[Service]
WorkingDirectory=/usr/local
ProtectProc=invisible
EnvironmentFile=-/etc/default/minio
ExecStartPre=/bin/bash -c "if [ -z \"${MINIO_VOLUMES}\" ]; then echo \"Variable MINIO_VOLUMES not set in /etc/default/minio\"; exit 1; fi"
ExecStart=/usr/local/bin/minio server $MINIO_OPTS $MINIO_VOLUMES
Restart=always
LimitNOFILE=65536
TasksMax=infinity
TimeoutStopSec=infinity
SendSIGKILL=no

[Install]
WantedBy=multi-user.target
```

**注意**：

重点关注上述文件中的以下内容即可

-  `EnvironmentFile`，该文件中可配置MinIO服务所需的各项参数 
-  `ExecStart`，该参数用于配置MinIO服务的启动命令，其中`$MINIO_OPTS`、`$MINIO_VOLUMES`，均引用于`EnvironmentFile`中的变量。 
   - `MINIO_OPTS`用于配置MinIO服务的启动选项，可省略不配置。
   - `MINIO_VOLUMES`用于配置MinIO服务的数据存储路径。
-  `Restart`，表示自动重启 
-  **编写**`**EnvironmentFile**`**文件**
执行以下命令创建并打开`/etc/default/minio`文件 
```bash
vim /etc/default/minio
```

内容如下，具体可参考[官方文档](https://min.io/docs/minio/linux/operations/install-deploy-manage/deploy-minio-single-node-single-drive.html#create-the-environment-variable-file)。 
```properties
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin
MINIO_VOLUMES=/data
MINIO_OPTS="--console-address :9001"
```

**注意** 

   -  `MINIO_ROOT_USER`和`MINIO_ROOT_PASSWORD`为用于访问MinIO的用户名和密码，**密码长度至少8位**。 
   -  `MINIO_VOLUMES`用于指定数据存储路径，需确保指定的路径是存在的，可执行以下命令创建该路径。 
```bash
mkdir /data
```


   -  `MINIO_OPTS`中的`console-address`,用于指定管理页面的地址。 

启动MinIO

执行以下命令启动MinIO
systemctl start minio
### redis

-  安装C语言环境 
```
yum -y install gcc
gcc --version
```
> 上传redis-7.0.10.tar.gz放/opt目录

> 解压命令：tar -zxvf redis-7.0.10.tar.gz

> 解压完成后进入目录：cd redis-7.0.10

> 在redis-7.0.10目录下再次执行make命令（只是编译好）

> 继续执行make install

#### Redis的启动和停止
#### 前台启动方式
```
redis-server  配置文件[后台启动即可]
```

- 不推荐原因: 窗口不能关闭,关闭则服务停止
#### 后台启动方式

- 在/root目录下创建myredis目录,用于存储启动使用的配置文件
```
cd /root
mkdir myredis
```

- 拷贝一份redis.conf到myredis目录
```
cp /opt/redis-7.0.10/redis.conf /root/myredis
```

- 修改配置文件中的内容         daemonize no改成yes 
```
修改redis.conf(257行附近?或者搜索 ) 文件将里面的daemonize no 改成 yes，让服务在后台启动
```

- 修改配置文件中的 bind ,注释该配置,取消绑定仅主机登录
- 修改protected-mode 为no,取消保护模式
- 启动redis时,使用我们自己修改之后的配置文件
```
redis-server /root/myredis/redis.conf
```

- 查看服务启动状态
```
ps -ef | grep redis
```
#### 通过客户端连接redis

- 通过客户端指令连接redis
```latex
redis-cli
```

- 如果想退出客户端可以 按 Ctrl+c  ,退出客户端不会关闭redis服务
- 通过客户端连接制定端口下的redis (默认6379)
```latex
redis-cli -p 6379
```

- 连接后,测试与redis的连通性
```latex
ping
```
#### 停止redis服务

- 单实例非客户端连接模式下关闭服务
```latex
redis-cli shutdown
```

- 在客户端连接模式下,直接使用shutdown关闭当前连接的redis服务
```latex
shutdown
```

- 多实例关闭指定端口的redis服务
```latex
redis-cli -p 6379 shutdown
```



### VUE3

### Nodejs

office  select  LTS vserion     and    node -v   or  npm -v   check vserion

#### npm 安装和配置

1. 安装Nodejs，自动安装npm包管理工具！

2. 使用镜像：

```
配置依赖下载使用阿里镜像：
	npm config set registry https://registry.npmmirror.com
查看当前 registry 的配置
	npm config get registry
如果需要恢复默认的官方源，可以执行以下命令：
	npm config set registry https://registry.npmjs.org
```

3. 配置全局依赖下载后存储位置：

- 在 Windows 系统上，npm 的全局依赖默认安装在 <用户目录>\AppData\Roaming\npm 目录下。
- 如果需要修改全局依赖的安装路径，可以按照以下步骤操作：

```
1. 创建一个新的全局依赖存储目录，例如D:\GlobalNodeModules  打开命令行终端，执行以下命令来配置新的全局依赖存储路径：
npm config set prefix "D:\GlobalNodeModules"
2. 确认配置已生效，可以使用以下命令查看当前的全局依赖存储路径：
npm config get prefix
3. 
```

4. 升级npm版本：

    cmd 输入npm -v 查看版本，如果node中自带的npm版本过低！升级最新

npm install -g npm@Last

#### npm 常用命令

1. 项目初始化：

- npm init
    - 进入一个vscode创建好的项目中，执行 npm init 命令后，npm 会引导您在命令行界面上回答一些问题，例如项目名称、版本号、作者、许可证等信息，并最终生成一个package.json 文件。package.json信息会包含项目基本信息！类似maven的pom.xml。
- npm init -y
    - 执行，-y   yes的意思，所有信息使用当前文件夹的默认值！不用挨个填写！

2、安装依赖 (查看所有依赖地址 [https://www.npmjs.com](https://www.npmjs.com/) )：

- npm install 包名 或者 npm install 包名@版本号
    - 安装包或者指定版本的依赖包(安装到当前项目中)。
- npm install -g 包名
    - 安装全局依赖包(安装到d:/GlobalNodeModules)则可以在任何项目中使用它，而无需在每个项目中独立安装该包。
- npm install
    - 安装package.json中的所有记录的依赖。

3、升级依赖：

- npm update 包名
    - 将依赖升级到最新版本。

4、卸载依赖：

- npm uninstall 包名

5、查看依赖：

- npm ls
    - 查看项目依赖。
- npm list -g
    - 查看全局依赖。

6、运行命令：

- npm run 命令是在执行 npm 脚本时使用的命令。npm 脚本是一组在 package.json 文件中定义的可执行命令。npm 脚本可用于启动应用程序，运行测试，生成文档等，还可以自定义命令以及配置需要运行的脚本。
- 在 package.json 文件中，scripts 字段是一个对象，其中包含一组键值对，键是要运行的脚本的名称，值是要执行的命令。
